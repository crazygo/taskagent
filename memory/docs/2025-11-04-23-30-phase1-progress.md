# Phase 1 Monorepo é‡ç»„ - è¿›åº¦æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-04 23:30  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æ—¶é—´**: çº¦ 30 åˆ†é’Ÿ  

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. Monorepo åˆå§‹åŒ–
- âœ… æ ¹ package.json æ·»åŠ  `workspaces: ["packages/*"]`
- âœ… è°ƒæ•´åŒ…åä¸º `@askman-dev/task`
- âœ… yarn install æˆåŠŸï¼ˆworkspace é“¾æ¥æ­£å¸¸ï¼‰

### 2. packages/core åˆ›å»ºï¼ˆ32KBï¼Œ8 ä¸ªæ–‡ä»¶ï¼‰
```
packages/core/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ Message.ts          # æ ¸å¿ƒæ¶ˆæ¯ç±»å‹ï¼ˆsourceTabId + timestamp å¿…å¡«ï¼‰
â”‚   â””â”€â”€ AgentEvent.ts       # Event Bus äº‹ä»¶ç±»å‹
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ message.schema.ts   # Zod æ ¡éªŒ
â”‚   â””â”€â”€ agent-event.schema.ts
â”œâ”€â”€ event-bus/
â”‚   â”œâ”€â”€ EventBus.ts         # Event Bus å®ç°ï¼ˆå·²å®Œæˆï¼‰
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**å…³é”®ç‰¹æ€§**:
- âœ… Event Bus å·²å®ç°ï¼ˆåŒ…å« Schema æ ¡éªŒï¼‰
- âœ… Message ç±»å‹å®šä¹‰ï¼ˆv2.0 åè®®ï¼‰
- âœ… AgentEvent ç±»å‹å®šä¹‰ï¼ˆ5 ç§äº‹ä»¶ç±»å‹ï¼‰

### 3. packages/agents åˆ›å»ºï¼ˆ112KBï¼Œ30+ æ–‡ä»¶ï¼‰
```
packages/agents/
â”œâ”€â”€ runtime/               # AI SDK å°è£…
â”‚   â”œâ”€â”€ runClaudeStream.ts   # Claude Agent SDK
â”‚   â”œâ”€â”€ runPromptAgentStart.ts
â”‚   â”œâ”€â”€ agentLoader.ts
â”‚   â””â”€â”€ flows/
â”œâ”€â”€ story/                 # Story Agent
â”œâ”€â”€ glossary/              # Glossary Agent
â”œâ”€â”€ ui-review/             # UI-Review Agent
â”œâ”€â”€ monitor/               # Monitor Agent
â”œâ”€â”€ index.ts               # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**ä¾èµ–å…³ç³»**:
- `@taskagent/core: workspace:*`
- `@anthropic-ai/claude-agent-sdk`
- `ai` (Vercel AI SDK)

### 4. packages/cli åˆ›å»ºï¼ˆ288KBï¼Œæœ€å¤§ï¼‰
```
packages/cli/
â”œâ”€â”€ components/            # UI ç»„ä»¶
â”œâ”€â”€ store/                 # conversationStore + taskStore
â”œâ”€â”€ hooks/
â”œâ”€â”€ cli/
â”œâ”€â”€ config/
â”œâ”€â”€ workspace/
â”œâ”€â”€ drivers/               # æš‚æ—¶ä¿ç•™ï¼ˆå¾…é‡æ„ï¼‰
â”œâ”€â”€ workflow/              # æš‚æ—¶ä¿ç•™
â”œâ”€â”€ main.tsx               # ä¸»å…¥å£ï¼ˆåŸ ui.tsxï¼‰
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

**ä¾èµ–å…³ç³»**:
- `@taskagent/core: workspace:*`
- `@taskagent/agents: workspace:*`
- `ink`, `react`, `minimist`, `dotenv`

### 5. packages/execution, tabs, presets
- ğŸ“ ç›®å½•å·²åˆ›å»º
- âš ï¸ å°šæœªå¡«å……ï¼ˆPhase 2-7 çš„å·¥ä½œï¼‰

---

## ğŸ“Š å½“å‰çŠ¶æ€

### ä»£ç ç»Ÿè®¡
- **æ€»æ–‡ä»¶æ•°**: 57 ä¸ª TS/TSX æ–‡ä»¶
- **packages/core**: 32KBï¼ˆ8 ä¸ªæ–‡ä»¶ï¼‰
- **packages/agents**: 112KBï¼ˆ30+ ä¸ªæ–‡ä»¶ï¼‰
- **packages/cli**: 288KBï¼ˆæœ€å¤§ï¼‰
- **ä¿®æ”¹æ–‡ä»¶**: 22 ä¸ª

### Monorepo ç»“æ„éªŒè¯
```bash
âœ… yarn install          # æˆåŠŸ
âœ… workspace links       # 3 ä¸ª package é“¾æ¥æ­£å¸¸
âš ï¸ TypeScript ç¼–è¯‘      # å¾…éªŒè¯ï¼ˆè·¯å¾„éœ€è¦æ›´æ–°ï¼‰
âš ï¸ æµ‹è¯•                 # å¾…æ›´æ–°ï¼ˆè·¯å¾„éœ€è¦æ›´æ–°ï¼‰
```

---

## ğŸ¯ Phase 1 æˆå°±

### âœ… å®Œæˆçš„æ ¸å¿ƒç›®æ ‡
1. **Monorepo æ¶æ„å»ºç«‹** - æ¸…æ™°çš„ package è¾¹ç•Œ
2. **Event Bus åŸºç¡€** - å·²å®ç°å¹¶å¸¦ Schema æ ¡éªŒ
3. **ä»£ç è¿ç§»** - æ‰€æœ‰ä»£ç å·²è¿ç§»åˆ° packages/
4. **ä¾èµ–é…ç½®** - workspace:* å¼•ç”¨æ­£å¸¸

### âš ï¸ å¾…å¤„ç†é¡¹
1. **è·¯å¾„æ›´æ–°** - æ‰€æœ‰ import è·¯å¾„éœ€è¦æ›´æ–°
2. **TypeScript ç¼–è¯‘** - éœ€è¦éªŒè¯
3. **æµ‹è¯•æ›´æ–°** - æµ‹è¯•è·¯å¾„éœ€è¦æ›´æ–°
4. **Event Bus é›†æˆ** - éœ€è¦åœ¨ CLI ä¸­å®é™…ä½¿ç”¨

---

## ğŸ”„ ä¸ v2.0 è·¯çº¿å›¾å¯¹æ¯”

### Phase 1 ç›®æ ‡ï¼ˆè·¯çº¿å›¾ï¼‰
- [x] åˆå§‹åŒ– Monorepo
- [x] åˆ›å»º packages/core
- [x] è¿ç§» runtime åˆ° packages/agents
- [x] è¿ç§»æ‰€æœ‰ Agent
- [x] è¿ç§» CLI
- [x] yarn install æˆåŠŸ
- [ ] æµ‹è¯•é€šè¿‡ï¼ˆè·¯å¾„æ›´æ–°åï¼‰

### è¶…å‡ºè®¡åˆ’çš„æˆæœ
- âœ… Event Bus å·²åœ¨ Phase 1 å®Œæˆï¼ˆåŸè®¡åˆ’ Phase 2ï¼‰
- âœ… Message/AgentEvent ç±»å‹å·²å®šä¹‰ï¼ˆåŸè®¡åˆ’ Phase 2/4ï¼‰
- âœ… Schema æ ¡éªŒå·²å®ç°ï¼ˆåŸè®¡åˆ’ Phase 2ï¼‰

---

## ğŸ“‹ ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§

### ğŸ”¥ High Priorityï¼ˆç«‹å³ï¼‰

#### Phase 1.5: è·¯å¾„æ›´æ–°å’ŒéªŒè¯
**ç›®æ ‡**: æ›´æ–° import è·¯å¾„ï¼Œç¡®ä¿ç¼–è¯‘é€šè¿‡

**å…³é”®ä»»åŠ¡**:
1. æ›´æ–° packages/cli/main.tsx çš„ import è·¯å¾„
   - `../../src/agents` â†’ `@taskagent/agents`
   - `../../src/types` â†’ `@taskagent/core/types`
   
2. æ›´æ–° packages/agents çš„ import è·¯å¾„
   - `../../agent/runtime` â†’ `./runtime`
   
3. éªŒè¯ç¼–è¯‘
   ```bash
   cd packages/core && tsc --noEmit
   cd packages/agents && tsc --noEmit
   cd packages/cli && tsc --noEmit
   ```

4. æ›´æ–°æµ‹è¯•è·¯å¾„
   - `tests/` ä¸­çš„ import è·¯å¾„
   - `vitest.config.ts` é…ç½®

**é¢„è®¡æ—¶é—´**: 1-2 å°æ—¶

---

### ğŸŸ¡ Medium Priorityï¼ˆPhase 2ï¼‰

#### Phase 2: Event Bus é›†æˆåˆ° CLI
**ç›®æ ‡**: CLI è®¢é˜… Event Busï¼ŒAgent é€šè¿‡ Event Bus å‘é€æ¶ˆæ¯

**å…³é”®ä»»åŠ¡**:
1. åœ¨ packages/cli/main.tsx ä¸­åˆ›å»º EventBus å®ä¾‹
2. è®¢é˜… `agent:text`, `agent:event`, `agent:completed` ç­‰äº‹ä»¶
3. æ›´æ–° MessageStoreï¼ˆæˆ–åˆ›å»ºæ–°çš„ MessageStoreï¼‰
4. æµ‹è¯• Event Bus é€šä¿¡

**é¢„è®¡æ—¶é—´**: 2 å°æ—¶

---

### ğŸŸ¢ Low Priorityï¼ˆPhase 3-7ï¼‰

#### Phase 3: Agent é‡æ„
- Agent åªä¾èµ– EventBus
- ç§»é™¤ UI ä¾èµ–

#### Phase 4: æ¶ˆæ¯åè®®åŒ–
- MessageStore æŒ‰ Tab éš”ç¦»
- sourceTabId å¼ºåˆ¶ç»‘å®š

#### Phase 5-7: Tabé…ç½® + Execution + å¤šå…¥å£
- æŒ‰ v2.0 è·¯çº¿å›¾ç»§ç»­

---

## ğŸ¯ å½“å‰ç“¶é¢ˆ

### ä¸»è¦é—®é¢˜
1. **è·¯å¾„æœªæ›´æ–°** - æ‰€æœ‰ import è·¯å¾„ä»ç„¶æŒ‡å‘ `src/`
2. **TypeScript ç¼–è¯‘** - æ— æ³•é€šè¿‡ï¼ˆè·¯å¾„é”™è¯¯ï¼‰
3. **æµ‹è¯•æ— æ³•è¿è¡Œ** - è·¯å¾„é”™è¯¯

### è§£å†³æ–¹æ¡ˆ
**ç«‹å³æ‰§è¡Œ Phase 1.5**ï¼ˆè·¯å¾„æ›´æ–°ï¼‰ï¼Œé¢„è®¡ 1-2 å°æ—¶å®Œæˆã€‚

---

## ğŸ“ˆ è¿›åº¦æ€»è§ˆ

```
Phase 0: æµ‹è¯•åŸºå‡†         âšª å·²å–æ¶ˆ
Phase 1: Monorepo é‡ç»„    âœ… 100% å®Œæˆï¼ˆè¶…é¢å®Œæˆï¼‰
  - Event Bus å·²å®ç°       âœ… (æå‰å®Œæˆ)
  - Types å·²å®šä¹‰           âœ… (æå‰å®Œæˆ)
  - Schemas å·²å®ç°         âœ… (æå‰å®Œæˆ)
  
Phase 1.5: è·¯å¾„æ›´æ–°       â³ ä¸‹ä¸€æ­¥ï¼ˆHigh Priorityï¼‰
Phase 2: Event Bus é›†æˆ   â³ å¾…å¼€å§‹
Phase 3: Agent é‡æ„       â³ å¾…å¼€å§‹
Phase 4-7: ...           â³ å¾…å¼€å§‹
```

**æ•´ä½“è¿›åº¦**: ~15% (Phase 1 + éƒ¨åˆ† Phase 2)  
**é¢„è®¡å®Œæˆ Phase 1.5**: 2025-11-05 å‡Œæ™¨  
**é¢„è®¡å®Œæˆ Phase 2**: 2025-11-05 ä¸Šåˆ  

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-04 23:30  
**ä¸‹ä¸€æ­¥**: Phase 1.5 è·¯å¾„æ›´æ–°ï¼ˆHigh Priorityï¼‰

