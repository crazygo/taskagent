# 设计文档：Mediator 驱动的开发与审查架构 (简洁版)

## 1. 核心组件

#### A. Mediator Agent (中介)

*   **定位**: 用户交互接口与后台任务调度器。
*   **核心能力**:
    1.  **基础操作**: 能理解用户指令，并调用文件操作、命令行等基础工具。
    2.  **智能委派**: 能解析用户的自然语言，并自动生成指令，在后台启动 `Coder Agent` 来执行开发任务。
    3.  **状态查询**: 能理解用户的“看看进展”等意图，并调用 `Reporter Agent` 来生成和展示后台任务的进度摘要。
    4.  **循环控制**: 能根据用户指令，启动或终止 `Loop Manager` 的持续审查循环。
    5.  **接收警报**: 能接收由 `Loop Manager` 主动推送的关键警报，并将其呈现给用户。

#### B. Coder Agent (开发者)

*   **定位**: 一次性的后台代码生成与修改任务执行者。
*   **触发方式**: 由 Mediator Agent 通过 `/bg:coder <任务描述>` 指令在后台启动。

#### C. Reporter Agent (报告者)

*   **定位**: 一次性的后台日志分析与摘要生成器。
*   **触发方式**: 由 Mediator Agent 在需要时（例如用户查询进度，或 Coder 任务完成后）通过 `/bg:reporter <日志文件>` 指令在后台启动。

#### D. Loop Manager (循环管理器)

*   **定位**: **非 Agent 的**后台定时调度模块。
*   **职责**:
    1.  **管理定时循环**: 内部包含一个定时器，在被激活时，按固定间隔调用 `Reviewer Agent`。
    2.  **解析与推送**: 负责解析 `Reviewer Agent` 返回的审查报告，并在发现严重问题时，主动向 Mediator Agent 推送警报。

#### E. Reviewer Agent (审查者)

*   **定位**: 一次性的、深入的质量审查报告生成器。
*   **触发方式**: 由 `Loop Manager` 在每个循环周期中调用。
*   **职责**: 执行一次完整的、多维度的（例如需求符合度、日志、代码变更）质量审查，并生成一份结构化的“审查报告”。

## 2. 核心工作流 (ASCII 图)

```
+-------+                                +------------------------------------------------------+
|       |                                |  A. Mediator Agent (总指挥)                          |
|  用户  |                                |  (解析用户意图，调用 Coder, Reporter, Loop Manager)  |
+-------+                                +------------------------------------------------------+
    |                                                        |
    | "开始开发..." (自然语言)                                 |
    +------------------------------------------------------->| (启动 /bg:coder)
    |                                                        ▼
    |                                                +------------------+
    |                                                | B. Coder Agent   |
    |                                                +------------------+
    |                                                        | ▲
    | "看看进展"                                               | | (完成后，或按需)
    +------------------------------------------------------->| | (启动 /bg:reporter)
    |                                                        ▼ |
    |                                                +--------------------+
    |               "已完成 80%..."                    | C. Reporter Agent  |
    |<-----------------------------------------------| (分析日志并总结)   |
    |                                                +--------------------+
    |
    | "启动持续审查"
    +------------------------------------------------------->| (启动 Loop Manager)
    |                                                        ▼
    |                        +------------------------------------------------------------------+
    |                        | D. Loop Manager (后台调度器)                                     |
    |                        |                                                                  |
    |                        |   ↻ 定时调用 E. Reviewer Agent, 解析报告并推送警报             |
    |                        +------------------------------------------------------------------+
    |                                                        |
    |               "⚠️ 警告：发现严重问题..."                  | (收到主动推送)
    |<-------------------------------------------------------+
```
